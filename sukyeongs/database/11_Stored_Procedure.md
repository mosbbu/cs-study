## 🥅 저장 프로시저(Stored Procedure)

**저장 프로시저(Stored Procedure)** : 일련의 쿼리를 마치 하나의 함수처럼 실행하기 위한 **쿼리의 집합**

![](https://velog.velcdn.com/images/sukyeongs/post/93fe71f2-8f12-4fb7-ab77-21d25eb574ab/image.png)

데이터베이스에 대한 일련의 작업을 정리한 절차를 RDBMS(관계형 데이터베이스 관리 시스템)에 저장한 것으로 **영구 저장 모듈**이라고도 불린다.

<br>
<br>

### 프로시저 생성, 호출

프로시저를 생성하고 호출하는 방법은 아래와 같다.

#### 생성

```sql
CREATE OR REPLACE PROCEDURE 프로시저명(변수명1 IN 데이터타입, 변수명2 OUT 데이터타입) -- 인자 값은 필수 아님
IS
[
변수명1 데이터타입;
변수명2 데이터타입;
..
]
BEGIN
 필요한 기능; -- 인자값 활용 가능
END;
```

<br>

#### 호출

```sql
EXEC 프로시저명; -- 호출
```

<br>

#### 프로시저 생성, 호출 예시

- 생성

```sql
CREATE OR REPLACE PROCEDURE test( name IN VARCHAR2 )
IS
	msg VARCHAR2(5) := '내 이름은';
BEGIN
	dbms_output.put_line(msg||' '||name);
END;
```

`test` 라는 이름의 프로시저를 생성하거나 이미 존재한다면 대체한다.

`IS` 로 필요한 변수명과 타입을 지정한다. msg 변수는 VARCHAR2 타입이며 값은 '내 이름은' 이다.

`BEGIN` 으로 해당 프로시저가 수행해야 하는 작업을 명시한다. test 프로시저는 dbms에서 화면 출력을 수행하는 `put_line` 메소드를 수행한다. 이때 출력하는 값은 msg와 매개변수로 받은 name이다.

<br>

- 호출

```sql
EXEC test('란경');
```

'란경'이라는 VARCHAR2 타입의 변수를 매개변수로 하여 프로시저를 실행한다. 결과값은 `내 이름은 란경` 이다.

<br>

위와 같이 프로시저를 사용하면 여러줄의 쿼리문을 **한 번의 요청으로 실행**할 수 있으며, 인자 값만 바꾸어 동일한 로직의 쿼리문을 필요할 때마다 재작성할 필요 없이 **호출**만 하면 된다.

<br>
<br>

### 프로시저 장점

#### 1. 최적화 & 캐시

프로시저의 **최초 실행 시 최적화 상태로 컴파일**이 되며, 그 이후 **프로시저 캐시에 저장**된다. 해당 프로시저가 여러번 사용될 때, 컴파일 재작업을 거치지 않고 캐시에서 바로 가져온다.

#### 2. 유지보수

작업이 변경될 때, 다른 작업은 건드리지 않고 **프로시저 내부에서 수정**만 하면 된다.

#### 3. 트래픽 감소

직접 SQL을 작성하는 것이 아니라 프로시저명에 매개변수만 담아 전달하면 된다. 즉, SQL문 자체는 이미 서버에 저장되어 있기 때문에 클라이언트와 서버 간 **네트워크 상 트래픽이 감소**된다.

#### 4. 보안

프로시저 내에서 참조 중인 테이블의 접근을 막을 수 있다.

<br>
<br>

### 프로시저 단점

#### 1. 호환성

구문 규칙이 SQL / PSM 표준과의 호환성이 낮아 코드 재사용성이 좋지 않다.

#### 2. 성능

문자, 숫자 연산에서 프로그래밍 언어인 C나 Java보다 성능이 느리다.

#### 3. 디버깅

에러가 발생했을 때, 어디에서 잘못된 것인지 확인하는 디버깅 과정이 어렵다.

<br>

---

<br>

## Reference

- <a href="https://gyoogle.dev/blog/computer-science/data-base/Stored%20PROCEDURE.html">신입 개발자 전공 지식 & 기술 면접 백과사전</a>
- <a href="https://ko.wikipedia.org/wiki/저장_프로시저">저장 프로시저</a>
